{% extends 'base.html' %}
{% load static %}
{% block content %}

{% for post in posts %}
<div class="card mb-3 position-relative">

  <div class="row g-0">

    <!-- Avatar -->
    <div class="col-auto d-flex align-items-start p-3">
      <img
        src="https://randomuser.me/api/portraits/men/32.jpg"
        alt="avatar"
        class="rounded-circle"
        style="width: 50px; height: 50px; object-fit: cover"
      />
    </div>

    <!-- Content -->
    <div class="col">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center p-3 pb-1">
        <div class="d-flex align-items-center">
          <h6 class="mb-0 me-2">
            {{ post.user.first_name }} {{ post.user.last_name }}
          </h6>
          <h6 class="mb-0 text-muted">@{{ post.user.username }}</h6>
        </div>

        {% if request.user != post.user %}
          {% if post.user.id in following_ids %}
            <a href="{% url 'unfollow' post.user.id %}" class="btn btn-sm btn-outline-danger">
              Unfollow
            </a>
          {% else %}
            <a href="{% url 'follow' post.user.id %}" class="btn btn-sm btn-outline-primary">
              Follow
            </a>
          {% endif %}
        {% endif %}
      </div>

      <!-- Body (Clickable) -->
      <div class="px-3 pt-2 pb-2 position-relative">
        <a href="{% url 'post_detail' post.id %}" class="stretched-link"></a>

        {% if post.title %}
          <h6 class="fw-bold mb-1 text-dark">{{ post.title }}</h6>
        {% endif %}

        <p class="mb-2 text-body">{{ post.content }}</p>
      </div>

      <!-- Comment Form (Hidden) -->
      {% if user.is_authenticated %}
      <div id="comment-form-{{ post.id }}" class="mt-3 ps-3 border-start d-none">
        <form method="post" action="{% url 'add_comment' post.id %}">
          {% csrf_token %}
          <div class="d-flex gap-2">
            <textarea
              name="content"
              class="form-control"
              rows="2"
              placeholder="Write a comment..."
              required
            ></textarea>
            <button type="submit" class="btn btn-primary">
              Comment
            </button>
          </div>
        </form>
      </div>
      {% endif %}

      <!-- Footer -->
      <div class="d-flex justify-content-between align-items-center px-3 pt-2 pb-2 text-muted">
        <div>
          <button
            type="button"
            class="btn btn-link p-0 text-decoration-none"
            onclick="toggleCommentForm({{ post.id }})"
          >
          <span>üí¨ {{ comments_count}} Comments</span>

          </button>

          <a href="#" class="ms-3 text-decoration-none">‚ù§Ô∏è Like</a>
        </div>

        <small>{{ post.created_at|date:"M d, Y H:i" }}</small>
      </div>

    </div>
  </div>
</div>

{% empty %}
<p class="text-center text-muted">No posts to display.</p>
{% endfor %}

<!-- Floating Action Button -->
<a
  href="/post/create/"
  class="btn btn-primary rounded-circle shadow"
  style="
    position: fixed;
    bottom: 20px;
    right: 300px;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
  "
>
  +
</a>

<!-- JS -->
<script>
  function toggleCommentForm(postId) {
    const form = document.getElementById("comment-form-" + postId);
    form.classList.toggle("d-none");
  }
</script>

{% endblock %}
