{% extends 'base.html' %}
{% block content %}

<div class="container mt-4" style="max-width: 1000px;">

  <!-- Post Card -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div>
          <strong>
            {{ post.user.first_name }} {{ post.user.last_name }}
          </strong>
          <span class="text-muted">
            @{{ post.user.username }}
          </span>
        </div>
        <small class="text-muted">
          {{ post.created_at|date:"M d, Y H:i" }}
        </small>
      </div>

      <!-- Title -->
      {% if post.title %}
        <h5 class="fw-bold mb-2">{{ post.title }}</h5>
      {% endif %}

      <!-- Content -->
      <p class="fs-6">{{ post.content }}</p>

      <hr>

      <!-- Actions -->
      <div class="d-flex gap-4 text-muted align-items-center">
        <span>üí¨ {{ comments_count }} Comments</span>
        <span>‚ù§Ô∏è Like</span>

        {% if request.user == post.user %}
        <form method="post" action="{% url 'delete_post' post.id %}">
          {% csrf_token %}
          <button
            type="submit"
            class="btn btn-link text-danger p-0"
            onclick="return confirm('Delete this post?')"
            title="Delete post"
          >
            <i class="fa-solid fa-trash"></i>
          </button>
        </form>
        {% endif %}
      </div>

    </div>
  </div>

  <!-- Comment Form -->
  {% if user.is_authenticated %}
  <div class="card mb-4">
    <div class="card-body">
      <form method="post" action="{% url 'add_comment' post.id %}">
        {% csrf_token %}
        <div class="d-flex gap-2">
          <textarea
            name="content"
            class="form-control"
            rows="2"
            placeholder="Write a comment..."
            required
          ></textarea>
          <button class="btn btn-primary">Post</button>
        </div>
      </form>
    </div>
  </div>
  {% else %}
    <p class="text-muted">Login to comment.</p>
  {% endif %}

  <!-- Comment List -->
  <div class="card">
    <div class="card-body">

      <h6 class="fw-bold mb-3">
        Comments ({{ comments_count }})
      </h6>

      {% for comment in comments %}
      <div class="mb-3 pb-2 border-bottom">

        <div class="d-flex justify-content-between">
          <strong>
            {{ comment.user.first_name }} {{ comment.user.last_name }}
            <span class="text-muted">@{{ comment.user.username }}</span>
          </strong>
          <small class="text-muted">
            {{ comment.created_at|date:"M d, Y H:i" }}
          </small>
        </div>

        <p class="mb-1">{{ comment.content }}</p>

      </div>
      {% empty %}
        <p class="text-muted">No comments yet. Be the first!</p>
      {% endfor %}

    </div>
  </div>

</div>

{% endblock %}
